      SUBROUTINE HBARDIAG(IRREPX,SCR,MAXCOR,IUHF)
C
C Modified by SG (6/95) to use Hartree-Fock orbital energies for
C   Partitioned-EE calculations.
C
      IMPLICIT INTEGER (A-Z)
      DOUBLE PRECISION SCR(MAXCOR),ONEM
      LOGICAL SS, SD, DS, DD
      LOGICAL MBPT2,CC,CCD,RCCD,DRCCD,LCCD,LCCSD,CC2
      COMMON/MACHSP/IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
      COMMON/SYMPOP/IRPDPD(8,22),ISYTYP(2,500),ID(18)
      COMMON/SYMINF/NSTART,NIRREP,IRREPS(255,2),DIRPRD(8,8)
      COMMON/EXTRAP/MAXEXP,NREDUCE,NTOL,NSIZEC
      COMMON/DRVHBAR/SS, SD, DS, DD
      COMMON /REFTYPE/ MBPT2,CC,CCD,RCCD,DRCCD,LCCD,LCCSD,CC2
C
      DATA ONEM /-1.0D0/
C
       CALL DDENOM(SCR,MAXCOR/IINTFP,IUHF,IRREPX,447)
C       IF (DD .AND. .NOT. CC2) 
C     &    CALL DDENOM2(SCR,MAXCOR/IINTFP,IUHF,IRREPX,447)
C
C SINGLES PART
C
      IOFFC=1
      DO 10 ISPIN=1,1+IUHF
       NDIM=IRPDPD(IRREPX,8+ISPIN)
       ISCR=IOFFC+NDIM
       CALL GETLST(SCR(IOFFC),1,1,1,9,447+ISPIN)
       CALL VMINUS(SCR(IOFFC),NDIM)
       IF (DD) THEN
         LISTW=53+ISPIN
         CALL GETLST(SCR(ISCR),1,NDIM,1,IRREPX,LISTW)
#ifdef _DEBUG_LVL0
        call checksum("@-hbardiag,SS:",scr(iscr),ndim,s)
#endif 
         CALL SAXPY (NDIM,ONEM,SCR(ISCR),NDIM+1,SCR(IOFFC),1)
       ENDIF
       IOFFC=ISCR
10    CONTINUE
C
C DOUBLES PART
C
      DO 20 ISPIN=3,3-2*IUHF,-1
       LISTD=447+ISPIN
       DO 30 IRREPR=1,NIRREP
        IRREPL=DIRPRD(IRREPR,IRREPX)
        NUMDIS=IRPDPD(IRREPR,ISYTYP(2,LISTD))
        DISSIZ=IRPDPD(IRREPL,ISYTYP(1,LISTD))
        CALL GETLST(SCR(IOFFC),1,NUMDIS,1,IRREPR,LISTD)
#ifdef _DEBUG_LVL0
        call checksum("@-hbardiag,DD:",scr(ioffc),NUMDIS*DISSIZ,s)
#endif 
        CALL VMINUS(SCR(IOFFC),NUMDIS*DISSIZ)
        IOFFC=IOFFC+NUMDIS*DISSIZ
30     CONTINUE
20    CONTINUE
C
      IF(IUHF.EQ.0)THEN
       CALL SYMT2AB(IRREPX,SCR,SCR(NSIZEC+1),MAXCOR)
      ENDIF 
C
      CALL PUTLST(SCR,1,1,1,1,472)
C
      RETURN
      END
