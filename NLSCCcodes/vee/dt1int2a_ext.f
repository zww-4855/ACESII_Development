










      SUBROUTINE DT1INT2A_EXT(ICORE,MAXCOR,IUHF,IRREPT,IRREPW,
     &                    LISTT1,IOFFT1,LISTW0,LISTZ0,ANTI)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      LOGICAL ANTI
      INTEGER POP,VRT,DIRPRD,DISSYW,DISSYZ,DISSYZF
      DIMENSION ICORE(MAXCOR)
      DIMENSION I0T(2)
      COMMON/MACHSP/IINTLN,IFLTLN,IINTFP,IALONE,IBITWD
      COMMON/SYMINF/NSTART,NIRREP,IRREPS(255,2),DIRPRD(8,8)
      COMMON/SYM/POP(8,2),VRT(8,2),NT(2),NF1(2),NF2(2)
      COMMON/SYMPOP/IRPDPD(8,22),ISYTYP(2,500),ID(18)
      COMMON/SYMLOC/ISYMOFF(8,8,25)
      DATA ZILCH,ONE,ONEM/0.D0,1.D0,-1.D0/
      I0T(1)=1
      I0T(2)=I0T(1)+IUHF*IINTFP*IRPDPD(IRREPT,9)
      I000=I0T(2)+IINTFP*IRPDPD(IRREPT,10)
      CALL GETLST(ICORE(I0T(1)),1,1,1,1+IOFFT1,LISTT1)
      IF(IUHF.EQ.1) CALL GETLST(ICORE(I0T(2)),1,1,1,2+IOFFT1,LISTT1)
      IRREPX=DIRPRD(IRREPW,IRREPT)
      FACT=ONE
      IF(ANTI) FACT=ONEM
      DO 100 IRREPZR=1,NIRREP
       IRREPZL=DIRPRD(IRREPX,IRREPZR)
       IRREPWL=IRREPZR
       IRREPWR=DIRPRD(IRREPW,IRREPWL)
       LISTW=LISTW0+3
       LISTZ=LISTZ0+2
       DISSYW=IRPDPD(IRREPWL,ISYTYP(1,LISTW))
       NUMDSW=IRPDPD(IRREPWR,ISYTYP(2,LISTW))
       DISSYZ=IRPDPD(IRREPZL,ISYTYP(1,LISTZ))
       NUMDSZ=IRPDPD(IRREPZR,ISYTYP(2,LISTZ))
       MAXBUF=MAX(NUMDSZ,NUMDSW,DISSYW,DISSYZ)
       I010=I000+IINTFP*DISSYZ*NUMDSZ
       I020=I010+IINTFP*MAX(DISSYW*NUMDSW,NUMDSZ*DISSYZ)
       ITMP1=I020
       ITMP2=ITMP1+IINTFP*MAXBUF
       ITMP3=ITMP2+IINTFP*MAXBUF
       IEND=ITMP3+IINTFP*MAXBUF
       IF(IEND.LT.MAXCOR) THEN
        CALL GETLST(ICORE(I010),1,NUMDSW,1,IRREPWR,LISTW)
        CALL SYMTR1(IRREPWR,POP(1,1),VRT(1,2),DISSYW,ICORE(I010),
     &              ICORE(ITMP1),ICORE(ITMP2),ICORE(ITMP3))
        DO 120 IRREPM=1,NIRREP
         IRREPA=DIRPRD(IRREPM,IRREPT)
         IRREPB=DIRPRD(IRREPM,IRREPWR)
         NROW=DISSYW*VRT(IRREPB,2)
         NCOL=VRT(IRREPA,1)
         NSUM=POP(IRREPM,1)
         IZ=I000+IINTFP*NUMDSZ*(ISYMOFF(IRREPA,IRREPZL,23)-1)
         IW=I010+IINTFP*DISSYW*(ISYMOFF(IRREPM,IRREPWR,12)-1)
         IT=I0T(1)+IINTFP*(ISYMOFF(IRREPM,IRREPT,9)-1)
         CALL XGEMM('N','T',NROW,NCOL,NSUM,-FACT,ICORE(IW),NROW,
     &              ICORE(IT),NCOL,ZILCH,ICORE(IZ),NROW)
120     CONTINUE
       ELSE
        WRITE(6,*) ' out-of-core AB not coded in dt2int2a'
        CALL ERREX
       ENDIF
       CALL SYMTR1(IRREPZL,VRT(1,2),VRT(1,1),NUMDSZ,ICORE(I000),
     &             ICORE(ITMP1),ICORE(ITMP2),ICORE(ITMP3))
       IF(IUHF.EQ.0) THEN
        CALL TRANSP(ICORE(I000),ICORE(I010),DISSYZ,NUMDSZ)
        CALL SYMRHF3(IRREPZL,IRREPZR,VRT(1,1),POP(1,1),DISSYZ,
     &               ICORE(I010),ICORE(ITMP1),ICORE(ITMP2),
     &               ICORE(ITMP3))
        CALL GETLST(ICORE(I000),1,NUMDSZ,1,IRREPZR,LISTZ)
        CALL SAXPY(NUMDSZ*DISSYZ,ONE,ICORE(I000),1,ICORE(I010),1)
        CALL PUTLST(ICORE(I010),1,NUMDSZ,1,IRREPZR,LISTZ)
       ELSE
        LISTW=LISTW0+2
        DISSYW=IRPDPD(IRREPWL,ISYTYP(1,LISTW))
        NUMDSW=IRPDPD(IRREPWR,ISYTYP(2,LISTW))
        IEND=I010+IINTFP*MAX(NUMDSZ*DISSYZ,NUMDSW*DISSYW)
        IF(IEND.LT.MAXCOR) THEN
         CALL GETLST(ICORE(I010),1,NUMDSW,1,IRREPWR,LISTW)
         DO 150 IRREPM=1,NIRREP
          IRREPB=DIRPRD(IRREPM,IRREPT)
          IRREPA=DIRPRD(IRREPM,IRREPWR)
          NROW=DISSYW*VRT(IRREPA,1)
          NCOL=VRT(IRREPB,2)
          NSUM=POP(IRREPM,2)
          IZ=I000+IINTFP*NUMDSZ*(ISYMOFF(IRREPB,IRREPZL,13)-1)
          IW=I010+IINTFP*DISSYW*(ISYMOFF(IRREPM,IRREPWR,11)-1)
          IT=I0T(2)+IINTFP*(ISYMOFF(IRREPM,IRREPT,10)-1)
          CALL XGEMM('N','T',NROW,NCOL,NSUM,-FACT,ICORE(IW),NROW,
     &               ICORE(IT),NCOL,ONE,ICORE(IZ),NROW)
150      CONTINUE
        ELSE
         WRITE(6,*) ' out-of-core not coded yet in dt1int2a'
         CALL ERREX
        ENDIF
        CALL TRANSP(ICORE(I000),ICORE(I010),DISSYZ,NUMDSZ)
        CALL GETLST(ICORE(I000),1,NUMDSZ,1,IRREPZR,LISTZ)
        CALL SAXPY(NUMDSZ*DISSYZ,ONE,ICORE(I000),1,ICORE(I010),1)
        CALL PUTLST(ICORE(I010),1,NUMDSZ,1,IRREPZR,LISTZ)
       ENDIF
100   CONTINUE
      IF(IUHF.EQ.0) RETURN
      DO 200 ISPIN=1,1+IUHF
       DO 210 IRREPZR=1,NIRREP
        IRREPZL=DIRPRD(IRREPZR,IRREPX) 
        IRREPWL=IRREPZR
        IRREPWR=DIRPRD(IRREPW,IRREPWL)
        LISTW=LISTW0-1+ISPIN
        LISTZ=LISTZ0-1+ISPIN
        DISSYW=IRPDPD(IRREPWL,ISYTYP(1,LISTW))
        NUMDSW=IRPDPD(IRREPWR,ISYTYP(2,LISTW))
        DISSYZ=IRPDPD(IRREPZL,ISYTYP(1,LISTZ))
        NUMDSZ=IRPDPD(IRREPZR,ISYTYP(2,LISTZ))
        DISSYZF=IRPDPD(IRREPZL,18+ISPIN)
        MAXBUF=MAX(DISSYW,NUMDSW,DISSYZ,NUMDSZ,DISSYZF)
        I010=I000+IINTFP*DISSYZF*NUMDSZ
        I020=I010+IINTFP*MAX(NUMDSZ*DISSYZ,NUMDSW*DISSYW)
        ITMP1=I020
        ITMP2=ITMP1+IINTFP*MAXBUF 
        ITMP3=ITMP2+IINTFP*MAXBUF
        IEND=ITMP3+IINTFP*MAXBUF
        IF(IEND.LT.MAXCOR) THEN
         CALL GETLST(ICORE(I010),1,NUMDSW,1,IRREPWR,LISTW) 
         CALL SYMTR1(IRREPWR,POP(1,ISPIN),VRT(1,ISPIN),DISSYW, 
     &               ICORE(I010),ICORE(ITMP1),ICORE(ITMP2),
     &               ICORE(ITMP3))
         DO 230 IRREPM=1,NIRREP
          IRREPA=DIRPRD(IRREPM,IRREPT)
          IRREPB=DIRPRD(IRREPM,IRREPWR)
          NROW=DISSYW*VRT(IRREPB,ISPIN)
          NCOL=VRT(IRREPA,ISPIN)
          NSUM=POP(IRREPM,ISPIN)
          IZ=I000+IINTFP*NUMDSZ*(ISYMOFF(IRREPA,IRREPZL,18+ISPIN)-1)
          IW=I010+IINTFP*DISSYW*(ISYMOFF(IRREPM,IRREPWR,8+ISPIN)-1)
          IT=I0T(ISPIN)+IINTFP*(ISYMOFF(IRREPM,IRREPT,8+ISPIN)-1)
          CALL XGEMM('N','T',NROW,NCOL,NSUM,FACT,ICORE(IW),NROW,
     &               ICORE(IT),NCOL,ZILCH,ICORE(IZ),NROW)
230      CONTINUE
         CALL ASSYM2(IRREPZL,VRT(1,ISPIN),NUMDSZ,ICORE(I000))
         CALL TRANSP(ICORE(I000),ICORE(I010),DISSYZ,NUMDSZ)
         CALL GETLST(ICORE(I000),1,NUMDSZ,1,IRREPZR,LISTZ)
         CALL SAXPY(NUMDSZ*DISSYZ,ONE,ICORE(I000),1,ICORE(I010),1)
         CALL PUTLST(ICORE(I010),1,NUMDSZ,1,IRREPZR,LISTZ)
        ELSE
         WRITE(6,*) ' out-of-core algorithm not yet coded for dt1int2a'
         CALL ERREX
        ENDIF
210    CONTINUE
200   CONTINUE
      RETURN
      END 
